Refine ONLY the next step(s) in the execution plan based on the current DOM state after successful step execution.

Current Plan:
{{originalPlan}}

Current DOM Structure (simplified):
{{domStructure}}

Current URL: {{url}}

Last Executed Step:
{{lastExecutedStep}}

Next Step to Refine:
{{nextStep}}

Task:
1. FIRST: Check if the next step is unnecessary based on current DOM state:
   - Look for steps that say "click X to reveal Y", "open form/modal", "click to show", "reveal", etc. - check if Y/form/modal is already visible
   - CRITICAL: If you see form elements (input[type="email"], input[type="password"], form tags) in the DOM structure, the login form is ALREADY VISIBLE on the page
   - CRITICAL: If the next step says "click login button to reveal login form" but the DOM shows email/password inputs, REMOVE that step immediately
   - Analyze the DOM structure to see if forms, modals, or other UI elements mentioned in the next step description are already present and visible
   - Check for form elements (input[type="email"], input[type="password"], form tags) - if they exist in the DOM, the form is ALREADY VISIBLE, no need to click anything
   - Check for modal/dialog elements with role="dialog" or class names containing "modal" - if they exist and are visible, the modal is open
   - If the next step is a prerequisite that's no longer needed, mark it for removal
   - Examples: 
     * Step: "Click login button to reveal login form" → Check DOM for input[type="email"] or input[type="password"] → If found → REMOVE step (form is already visible)
     * Step: "Click login button or link" when form is already visible → REMOVE step
     * Step: "Open modal" → Check DOM for modal elements → If modal is visible → REMOVE step
     * Step: "Click dropdown to open menu" → Check DOM for menu elements → If menu is visible → REMOVE step

2. If the step is necessary, analyze the DOM structure for the next step:
   - Find the actual CSS selector for the element mentioned in the step description
   - Update selector with real DOM selector from the structure above
   - Provide confidence score (0-1) for the selector
   - Suggest 2-3 alternative selectors as fallbacks

3. Keep steps that don't need DOM interaction (navigate, wait) unchanged

Return ONLY the refinement for the next step:
- If step should be removed: Include it in removedSteps array with reason
- If step should be refined: Include updated step with refined selector and confidence
- Document refinement in refinements array

IMPORTANT: Only refine the NEXT step, not all remaining steps. This is incremental refinement after successful execution.

